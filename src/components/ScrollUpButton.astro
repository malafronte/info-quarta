---
// No props needed for this simple component
---

<button
    id="scroll-up-button"
    aria-label="Scroll to top"
    class="scroll-up-button"
>
    <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
    >
        <path d="M18 15l-6-6-6 6"></path>
    </svg>
</button>

<script>
    const scrollUpBtn = document.getElementById("scroll-up-button");
    const rightSidebar = document.querySelector(".right-sidebar-panel");
    let lastScrollY = window.scrollY;

    function updateButtonPosition() {
        if (!scrollUpBtn) return;

        // Default offset
        let rightOffset = 2; // rem

        if (rightSidebar) {
            const sidebarRect = rightSidebar.getBoundingClientRect();
            // Check if sidebar is actually visible and taking up space
            if (
                sidebarRect.width > 0 &&
                window.getComputedStyle(rightSidebar).display !== "none"
            ) {
                // Position with negative offset to overlap slightly with sidebar
                scrollUpBtn.style.right = `${sidebarRect.width - 14}px`; // width - 14px
                return;
            }
        }

        // Fallback if sidebar hidden
        scrollUpBtn.style.right = "2rem";
    }

    if (scrollUpBtn) {
        // Initial position
        updateButtonPosition();

        // Update on resize
        window.addEventListener("resize", updateButtonPosition);

        // Observe sidebar changes if it exists
        if (rightSidebar) {
            const resizeObserver = new ResizeObserver(() => {
                updateButtonPosition();
            });
            resizeObserver.observe(rightSidebar);

            // Also observe body for class changes that might affect sidebar display
            const mutationObserver = new MutationObserver(() => {
                updateButtonPosition();
            });
            mutationObserver.observe(document.body, {
                attributes: true,
                attributeFilter: ["class"],
            });
        }

        // Show/hide button based on scroll direction and position
        window.addEventListener("scroll", () => {
            const currentScrollY = window.scrollY;

            // Show if scrolling up AND not at the very top (e.g., > 300px)
            if (currentScrollY < lastScrollY && currentScrollY > 300) {
                scrollUpBtn.classList.add("visible");
            } else {
                // Hide if scrolling down OR at the top
                scrollUpBtn.classList.remove("visible");
            }

            lastScrollY = currentScrollY;
        });

        // Smooth scroll to top on click
        scrollUpBtn.addEventListener("click", () => {
            window.scrollTo({
                top: 0,
                behavior: "smooth",
            });
        });
    }
</script>

<style>
    .scroll-up-button {
        position: fixed;
        bottom: 2rem;
        right: 2rem; /* Default, overridden by JS */
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        background-color: var(--sl-color-bg-nav);
        border: 1px solid var(--sl-color-gray-5);
        color: var(--sl-color-text-accent);
        box-shadow: var(--sl-shadow-md);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 99999; /* Above everything */
        opacity: 0;
        visibility: hidden;
        transform: translateY(1rem);
        transition:
            opacity 0.3s ease,
            transform 0.3s ease,
            right 0.3s ease; /* Add transition for right */
    }

    .scroll-up-button:hover {
        background-color: var(--sl-color-gray-6);
        color: var(--sl-color-white);
        transform: translateY(-2px);
        box-shadow: var(--sl-shadow-lg);
    }

    .scroll-up-button.visible {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    /* Adjust position on mobile to avoid overlapping with other elements if needed */
    @media (max-width: 50rem) {
        .scroll-up-button {
            bottom: 1.5rem;
            right: 1.5rem !important; /* Force right on mobile */
            width: 2.5rem;
            height: 2.5rem;
        }
    }
</style>
